# === CLASES DE MONI (ellas ya las hizo) ===
class Cancion:
    def __init__(self, nombre, formato, ruta_archivo):
        self.nombre = nombre
        self.formato = formato
        self.ruta_archivo = ruta_archivo
        self.pistas = []

    def agregar_pista(self, pista):
        self.pistas.append(pista)

    def __str__(self):
        description = f"Nombre: {self.nombre} \n"
        description += f"Formato: {self.formato} \n"
        description += f"Ruta archivo: {self.ruta_archivo} \n"
        if self.pistas:
            description += "Pistas:\n"
            for p in self.pistas:
                description += f"  - {p.tipo}\n"
        return description

class Pista:
    def __init__(self, tipo, ruta_archivo):
        self.tipo = tipo
        self.ruta_archivo = ruta_archivo

    def __str__(self):
        description = f"Tipo: {self.tipo} \n"
        description += f"Ruta archivo: {self.ruta_archivo} \n"
        return description

class ProyectoAudio:
    def __init__(self, nombre_proyecto):
        self.nombre_proyecto = nombre_proyecto
        self.canciones = []

    def guardar_cancion(self, cancion):
        self.canciones.append(cancion)

    def __str__(self):
        description = f"Nombre: {self.nombre_proyecto} \n"
        description += f"--- CANCIONES --- \n"
        for cancion in self.canciones:
            description += f"{cancion} \n"
        return description

# === TU CLASE GESTORARCHIVOS ===
class GestorArchivos:
    @staticmethod
    def leer_json(ruta_archivo):
        import json
        try:
            with open(ruta_archivo, 'r', encoding='utf-8') as archivo:
                return json.load(archivo)
        except FileNotFoundError:
            print(f"Error: No se encontr√≥ {ruta_archivo}")
            return None
    
    @staticmethod
    def escribir_json(datos, ruta_archivo):
        import json
        with open(ruta_archivo, 'w', encoding='utf-8') as archivo:
            json.dump(datos, archivo, indent=2, ensure_ascii=False)
    
    @staticmethod
    def cargar_proyecto_desde_json(ruta_json):
        """CONEXI√ìN PRINCIPAL: Crea un ProyectoAudio completo desde JSON"""
        datos = GestorArchivos.leer_json(ruta_json)
        if datos:
            # Crear el proyecto usando la clase de Moni
            proyecto = ProyectoAudio(datos['nombre_proyecto'])
            
            # Crear cada canci√≥n usando la clase Cancion de Moni
            for cancion_data in datos.get('canciones', []):
                cancion = Cancion(
                    nombre=cancion_data['nombre'],
                    formato=cancion_data['formato'],
                    ruta_archivo=cancion_data['ruta_archivo']
                )
                
                # Crear cada pista usando la clase Pista de Moni
                for pista_data in cancion_data.get('pistas', []):
                    pista = Pista(
                        tipo=pista_data['tipo'],
                        ruta_archivo=pista_data['ruta_archivo']
                    )
                    # Usar el m√©todo de Moni para agregar pistas
                    cancion.agregar_pista(pista)
                
                # Usar el m√©todo de Moni para guardar canci√≥n
                proyecto.guardar_cancion(cancion)
            
            return proyecto
        return None

# === ARCHIVO JSON COMPLETO (con proyecto, canciones y pistas) ===
datos_proyecto_completo = {
    "nombre_proyecto": "Mi Proyecto Musical",
    "canciones": [
        {
            "nombre": "Summer Vibes",
            "formato": "mp3", 
            "ruta_archivo": "/audio/summer_vibes.mp3",
            "pistas": [
                {"tipo": "Voz Principal", "ruta_archivo": "/pistas/voz.wav"},
                {"tipo": "Bater√≠a", "ruta_archivo": "/pistas/drums.wav"},
                {"tipo": "Bajo", "ruta_archivo": "/pistas/bass.wav"}
            ]
        },
        {
            "nombre": "Rock Session", 
            "formato": "wav",
            "ruta_archivo": "/audio/rock_session.wav", 
            "pistas": [
                {"tipo": "Guitarra", "ruta_archivo": "/pistas/guitar.wav"},
                {"tipo": "Voz", "ruta_archivo": "/pistas/voz_rock.wav"}
            ]
        }
    ]
}

# === C√ìDIGO QUE CONECTA TODO ===
def demo_completa():
    print("üöÄ DEMO COMPLETA: Conexi√≥n Moni-Cla")
    print("=" * 55)
    
    # 1. TU PARTE: Crear el JSON con GestorArchivos
    GestorArchivos.escribir_json(datos_proyecto_completo, 'proyecto_musical.json')
    print("‚úÖ JSON creado por Cla (GestorArchivos)")
    
    # 2. CONEXI√ìN: Tu GestorArchivos usa las clases de Moni
    proyecto_cargado = GestorArchivos.cargar_proyecto_desde_json('proyecto_musical.json')
    
    if proyecto_cargado:
        print("‚úÖ Proyecto cargado usando clases de Moni")
        print("\n" + "=" * 55)
        
        # 3. MONI'S PARTE: Mostrar usando los __str__ de Moni
        print("üìä VISUALIZACI√ìN (usando m√©todos de Moni):")
        print("=" * 55)
        print(proyecto_cargado)  # ¬°Esto usa el __str__ de ProyectoAudio de Moni!
        
        print("\n" + "=" * 55)
        print("üéØ RESUMEN DE LA CONEXI√ìN:")
        print("- Cla: GestorArchivos lee/escribe JSON")
        print("- Moni: Clases Cancion, Pista, ProyectoAudio")  
        print("- Conexi√≥n: GestorArchivos CREA objetos de las clases de Moni")
        print("- Resultado: JSON ‚Üí Objetos ‚Üí Visualizaci√≥n en consola")
    else:
        print("‚ùå Error al cargar el proyecto")

# Ejecutar la demo
if __name__ == "__main__":
    demo_completa()
